# 架构概述

本文档介绍 Snapix 截图工具的整体架构设计，帮助开发者理解代码结构和工作原理。

## 整体架构

Snapix 采用模块化设计，主要由以下几个核心组件组成：

1. **弹出界面 (Popup)** - 用户点击扩展图标时显示的界面
2. **内容脚本 (Content Script)** - 在网页中执行的脚本，负责截图操作
3. **后台服务 (Background Service)** - 管理数据传输和存储的后台脚本
4. **预览界面 (Preview)** - 显示和编辑截图的界面
5. **多语言支持 (Internationalization)** - 处理多语言翻译

这些组件通过 Chrome Extension API 进行通信，形成一个完整的工作流程。

## 组件详解

### 弹出界面 (Popup)

**相关文件**：
- `popup.html` - 弹出窗口的 HTML 结构
- `popup.js` - 弹出窗口的交互逻辑
- `styles/popup.css` - 弹出窗口的样式

弹出界面是用户与扩展交互的主要入口，提供三种截图模式的选择和语言设置。当用户点击某个选项时，`popup.js` 会向当前标签页发送消息，触发相应的截图操作。

### 内容脚本 (Content Script)

**相关文件**：
- `content.js` - 在网页中执行的主要脚本
- `styles/content.css` - 内容脚本使用的样式

内容脚本在网页环境中运行，负责实际的截图操作。它使用 `html2canvas` 库捕获页面内容，并处理用户的选择区域交互。主要功能包括：

1. 捕获可视区域
2. 处理选择区域的用户交互
3. 捕获整个页面（通过滚动和拼接）
4. 将截图数据发送到后台服务

### 后台服务 (Background Service)

**相关文件**：
- `background.js` - 后台服务脚本

后台服务在扩展的生命周期内持续运行，负责：

1. 接收内容脚本发送的截图数据
2. 管理截图数据的临时存储
3. 打开预览页面并传递数据
4. 处理下载和保存操作

后台服务使用 Chrome 的消息传递 API 与内容脚本和预览页面通信，使用 Chrome 的下载 API 保存截图。

### 预览界面 (Preview)

**相关文件**：
- `preview.html` - 预览页面的 HTML 结构
- `preview.js` - 预览页面的交互和编辑逻辑

预览界面是用户编辑和保存截图的地方，它包含多种编辑工具和保存选项。主要功能包括：

1. 显示截图
2. 提供编辑工具（矩形、箭头、文本、马赛克等）
3. 处理用户的编辑操作
4. 提供保存和导出选项

预览界面使用 HTML5 Canvas 进行图像编辑，通过 Chrome 消息 API 与后台服务通信。

### 多语言支持 (Internationalization)

**相关文件**：
- `languages.js` - 多语言翻译数据

多语言支持模块提供了英语、简体中文、日语和西班牙语的翻译，使用自定义的国际化实现而不是 Chrome 的 i18n API，以便更灵活地处理语言切换。

## 数据流

Snapix 的数据流如下：

1. 用户点击扩展图标，打开弹出界面
2. 用户选择截图模式，`popup.js` 向当前标签页发送消息
3. `content.js` 接收消息并执行相应的截图操作
4. 截图完成后，`content.js` 将截图数据（Base64 格式）发送到后台服务
5. `background.js` 接收数据，存储在内存中，并打开预览页面
6. 预览页面加载时，从后台服务请求截图数据
7. 用户在预览页面编辑截图
8. 用户点击保存，预览页面将编辑后的截图发送到后台服务
9. `background.js` 使用 Chrome 下载 API 保存截图

## 技术栈

Snapix 使用以下技术：

- **HTML5 Canvas** - 用于图像编辑和处理
- **Chrome Extension API** - 用于跨组件通信和浏览器集成
- **html2canvas** - 用于将网页内容转换为 Canvas 图像
- **原生 JavaScript** - 所有功能都使用原生 JavaScript 实现，无外部依赖

## 扩展点

Snapix 的架构设计考虑了可扩展性，主要的扩展点包括：

1. **编辑工具** - 在 `preview.js` 中可以轻松添加新的编辑工具
2. **语言支持** - 在 `languages.js` 中可以添加新的语言翻译
3. **截图模式** - 在 `content.js` 中可以实现新的截图模式
4. **导出选项** - 在 `preview.js` 和 `background.js` 中可以添加新的导出格式

## 性能考虑

Snapix 在设计时考虑了性能优化：

1. **内存管理** - 截图数据使用临时存储，并在使用后清理
2. **异步操作** - 使用异步操作处理截图和编辑，避免阻塞 UI
3. **按需加载** - 组件按需加载，减少资源占用
4. **图像优化** - 提供选项调整图像质量和格式，平衡文件大小和质量

## 安全考虑

Snapix 注重用户隐私和安全：

1. **本地处理** - 所有数据处理都在本地完成，不上传到服务器
2. **权限最小化** - 只请求必要的权限
3. **内容隔离** - 使用适当的内容安全策略
4. **数据清理** - 临时数据在使用后立即清理 